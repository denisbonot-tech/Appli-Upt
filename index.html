<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Up-T V2.1 | Pulse Mode</title>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        const firebaseConfig = {

  apiKey: "AIzaSyBIsxyL2jrrhvUpypSZqt4eakbZb2XR7Jk",

  authDomain: "up-t-network.firebaseapp.com",

  projectId: "up-t-network",

  storageBucket: "up-t-network.firebasestorage.app",

  messagingSenderId: "1066469813456",

  appId: "1:1066469813456:web:4b660350832ea1d95702d5",

  measurementId: "G-7CSRYYCZWV"

        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.db = db; // On rend la DB accessible pour nos fonctions
        console.log("Syst√®me de vote arm√© !");
    </script>

    <style>
        :root { --bg: #000000; --accent: #ffffff; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; background: var(--bg); font-family: 'Segoe UI', sans-serif; color: white; }
        
        header { position: fixed; top: 0; width: 100%; padding: 25px; z-index: 100; text-align: center; font-weight: 100; letter-spacing: 12px; font-size: 20px; }
        
        .viewport { display: flex; width: 300vw; height: 100vh; transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        .screen { width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }

        /* LE CARROSSE DESIGN */
        .story-container { 
            width: 88%; height: 60%; border: 1px solid #222; background: #050505; 
            position: relative; overflow: hidden;
            box-shadow: 0 0 50px rgba(255,255,255,0.03);
            display: flex; align-items: center; justify-content: center;
        }

        /* BOUTON VOTE (L'√âCLAIR) */
        .vote-zone { position: absolute; bottom: 20px; right: 20px; text-align: center; }
        .btn-vote { 
            background: white; border: none; width: 60px; height: 60px; border-radius: 50%;
            cursor: pointer; font-size: 24px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 20px rgba(255,255,255,0.4); transition: 0.2s;
        }
        .btn-vote:active { transform: scale(1.3); filter: brightness(1.5); }

        .btn-main { background: #fff; color: #000; border: none; padding: 15px 40px; font-weight: 900; letter-spacing: 4px; clip-path: polygon(10% 0, 100% 0, 90% 100%, 0% 100%); margin-top: 20px; }
    </style>
</head>
<body onload="init()">

    <header>UP ‚Äî T</header>

    <div class="viewport" id="main-viewport">
        <section class="screen"><h1>MISSIONS</h1></section>
        
        <section class="screen">
            <div class="story-container">
                <div id="pl-text" style="opacity: 0.2; font-weight: 100;">CONCEPT_VIEW_01</div>
                
                <div class="vote-zone">
                    <button class="btn-vote" onclick="castVote()">‚ö°</button>
                    <p id="vote-count" style="font-size: 12px; margin-top: 5px; font-weight: 900;">0</p>
                </div>
            </div>
            <button class="btn-main">POSTER</button>
        </section>

        <section class="screen"><h1>TOP_10</h1></section>
    </div>

    <script>
        let cur = 1;
        const v = document.getElementById('main-viewport');

        function init() {
            // On centre sur la page du milieu (Le Carrosse)
            v.style.transform = `translateX(-100vw)`;
        }

        // --- LA FONCTION DE VOTE CORRIG√âE ---
        async function castVote() {
            console.log("Tentative d'envoi du vote...");

            // V√©rification : est-ce que Firebase est bien charg√© ?
            if (!window.db) {
                console.error("Erreur : La base de donn√©es n'est pas initialis√©e.");
                alert("Syst√®me non pr√™t. V√©rifie tes cl√©s API en haut du fichier.");
                return;
            }

            try {
                // On importe les outils Firebase n√©cessaires depuis le module global
                // Note : On utilise window.db que tu as d√©fini dans ton premier script
                const { doc, updateDoc, increment } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
                
                const docRef = doc(window.db, "challenges", "week_01");

                await updateDoc(docRef, {
                    votes: increment(1)
                });

                // Si on arrive ici, √ßa a march√© !
                console.log("üî• SUCC√àS ! Vote enregistr√© dans le Cloud.");
                
                let countLabel = document.getElementById('vote-count');
                countLabel.innerText = parseInt(countLabel.innerText) + 1;

            } catch (error) {
                console.error("‚ùå ERREUR FIREBASE :", error);
                alert("Le signal a √©chou√©. V√©rifie que la collection 'challenges' existe dans Firebase.");
            }
        }// --- FONCTION POUR √âCOUTER LE SCORE EN DIRECT ---
import { onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

function listenToVotes() {
    const docRef = doc(window.db, "challenges", "week_01");

    // Cette fonction surveille le document "week_01" 24h/24
    onSnapshot(docRef, (doc) => {
        if (doc.exists()) {
            const currentVotes = doc.data().votes;
            // On met √† jour le texte sur ton site avec la vraie valeur du Cloud
            document.getElementById('vote-count').innerText = currentVotes;
            console.log("Mise √† jour Cloud re√ßue : " + currentVotes);
        }
    });
}

// On lance l'√©coute d√®s que la page est pr√™te
// Ajoute cette ligne dans ta fonction init() ou juste ici :
setTimeout(listenToVotes, 1000);
    </script>
</body>
</html>
