<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Up-T | V7.6 Stable</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Inter:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f3ff; --bg: #000000; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--bg); font-family: 'Inter', sans-serif; color: white; }
        
        /* SPLASH QUICK */
        #splash { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .t-tron { font-family: 'Orbitron'; font-size: 50px; color: var(--neon); text-shadow: 0 0 20px var(--neon); animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* UI */
        #app-content { opacity: 0; transition: 0.5s; height: 100%; }
        #view { display: flex; width: 500vw; height: 100vh; transition: transform 0.4s ease-out; transform: translateX(-200vw); }
        .page { width: 100vw; height: 100vh; flex-shrink: 0; overflow-y: auto; position: relative; }
        
        /* FEED */
        .post { width: 100vw; height: 100vh; position: relative; scroll-snap-align: start; background: #111; border-bottom: 1px solid #222; }
        .post img { width: 100%; height: 100%; object-fit: cover; }
        .v-btn { position: absolute; right: 20px; bottom: 120px; width: 60px; height: 60px; border-radius: 50%; border: none; background: white; font-size: 25px; box-shadow: 0 0 15px var(--neon); }

        /* CHAT */
        #c-list { height: 75vh; overflow-y: auto; padding: 20px; margin-top: 40px; display: flex; flex-direction: column; gap: 8px; }
        .m { padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px; border-left: 3px solid var(--neon); font-size: 0.9rem; }
        
        /* NAV */
        nav { position: fixed; bottom: 0; width: 100%; height: 65px; background: rgba(0,0,0,0.9); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid var(--neon); z-index: 100; }
        .n { font-size: 22px; opacity: 0.4; }
        .n.active { opacity: 1; color: var(--neon); }
    </style>
</head>
<body>

    <div id="splash"><div class="t-tron">Up-T</div></div>

    <div id="app-content">
        <div id="view">
            <div class="page" style="display:flex; flex-direction:column; justify-content:center; align-items:center;">
                <button onclick="document.getElementById('f-in').click()" style="width:100px; height:100px; border-radius:50%; border:none; background:var(--neon); font-size:40px;">üì∏</button>
                <p>PUBLIER</p>
            </div>
            <div class="page" style="padding:100px 20px; text-align:center;">
                <h2>PILOTE</h2>
                <input type="text" id="u-in" placeholder="Nom..." style="padding:15px; width:80%; background:#222; border:1px solid var(--neon); color:white; border-radius:10px;">
                <button onclick="saveU()" style="margin-top:20px; padding:15px 40px; border-radius:10px; border:none; font-weight:900;">OK</button>
            </div>
            <div class="page" id="feed"></div>
            <div class="page" id="podium"></div>
            <div class="page">
                <div id="c-list"></div>
                <div style="position:fixed; bottom:80px; width:90%; left:5%; display:flex; gap:5px;">
                    <input type="text" id="c-in" style="flex:1; padding:12px; background:#222; border:1px solid var(--neon); color:white; border-radius:5px;" placeholder="Message...">
                    <button onclick="sMsg()" style="padding:12px; background:var(--neon); border:none; border-radius:5px;">‚ö°</button>
                </div>
            </div>
        </div>
        <input type="file" id="f-in" style="display:none" accept="image/*">
        <nav>
            <div class="n" onclick="go(0)">‚ûï</div>
            <div class="n" onclick="go(1)">üë§</div>
            <div class="n active" onclick="go(2)">üöÄ</div>
            <div class="n" onclick="go(3)">üèÜ</div>
            <div class="n" onclick="go(4)">üí¨</div>
        </nav>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, limit, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const config = { 
            apiKey: "AIzaSyBIsxyL2jrrhvUpypSZqt4eakbZb2XR7Jk", 
            authDomain: "up-t-network.firebaseapp.com", 
            projectId: "up-t-network", 
            storageBucket: "up-t-network.firebasestorage.app", 
            messagingSenderId: "1066469813456", 
            appId: "1:1066469813456:web:4b660350832ea1d95702d5" 
        };
        const app = initializeApp(config);
        const db = getFirestore(app);
        let user = localStorage.getItem('u') || "Anonyme";
        document.getElementById('u-in').value = user;

        // Splash
        setTimeout(() => { 
            document.getElementById('splash').style.display = 'none';
            document.getElementById('app-content').style.opacity = '1';
        }, 1500);

        // Nav
        window.go = (i) => {
            document.getElementById('view').style.transform = `translateX(${-i*100}vw)`;
            document.querySelectorAll('.n').forEach((el, idx) => el.classList.toggle('active', i === idx));
        };

        // Profil
        window.saveU = () => { user = document.getElementById('u-in').value; localStorage.setItem('u', user); go(2); };

        // Post
        document.getElementById('f-in').onchange = (e) => {
            const f = e.target.files[0];
            const r = new FileReader();
            r.readAsDataURL(f);
            r.onload = async () => {
                try {
                    await addDoc(collection(db, "posts"), { img: r.result, user, v: 0, t: Date.now() });
                    go(2);
                } catch(e) { alert("Erreur post !"); }
            };
        };

        // Feed
        onSnapshot(query(collection(db, "posts"), orderBy("t", "desc")), (s) => {
            const f = document.getElementById('feed'); f.innerHTML = "";
            s.forEach(d => {
                const data = d.data();
                f.innerHTML += `<div class="post"><img src="${data.img}"><div style="position:absolute; bottom:120px; left:20px; font-weight:900;">@${data.user}</div><button class="v-btn" onclick="v('${d.id}')">üî•</button><div style="position:absolute; right:35px; bottom:95px; font-weight:bold;">${data.v||0}</div></div>`;
            });
        });

        window.v = async (id) => { await updateDoc(doc(db, "posts", id), { v: increment(1) }); };

        // Chat
        window.sMsg = async () => {
            const i = document.getElementById('c-in');
            if(i.value.trim()){
                await addDoc(collection(db, "chats"), { u: user, m: i.value, t: Date.now() });
                i.value = "";
            }
        };

        onSnapshot(query(collection(db, "chats"), orderBy("t", "desc"), limit(30)), (s) => {
            const l = document.getElementById('c-list');
            l.innerHTML = s.docs.map(d => `<div class="m"><b>${d.data().u}:</b> ${d.data().m}</div>`).reverse().join('');
            l.scrollTop = l.scrollHeight;
        });
    </script>
</body>
</html>
