<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Up-T | V5.2 Stealth</title>
    <style>
        :root { --neon-blue: #00f3ff; --bg-dark: #000000; --glass: rgba(255, 255, 255, 0.1); }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background-color: var(--bg-dark);
            font-family: 'Inter', -apple-system, sans-serif;
            color: white; touch-action: none;
        }

        /* GPS SATELLITE (AU-DESSUS DE LA BARRE) */
        #gps-container {
            position: fixed; bottom: 60px; left: 50%;
            transform: translateX(-50%);
            display: flex; gap: 12px; z-index: 1001;
        }
        .dot { width: 6px; height: 6px; background: rgba(255,255,255,0.2); border-radius: 50%; transition: 0.4s; }
        .dot.active { background: white; box-shadow: 0 0 12px white; transform: scale(1.3); }

        /* BARRE DE TÂCHES ÉPURÉE 45PX */
        #taskbar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 45px;
            background: var(--glass); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-around; align-items: center;
            z-index: 1000; box-sizing: border-box;
        }
        .nav-item { display: flex; justify-content: center; align-items: center; cursor: pointer; opacity: 0.3; transition: 0.3s; width: 20%; height: 100%; }
        .nav-item.active { opacity: 1; color: var(--neon-blue); }
        .nav-item svg { width: 22px; height: 22px; fill: currentColor; }

        /* VIEWPORT HORIZONTAL */
        #main-viewport {
            display: flex; width: 500vw; height: 100vh;
            transition: transform 0.6s cubic-bezier(0.19, 1, 0.22, 1);
            transform: translateX(-200vw);
        }
        .page { 
            width: 100vw; height: 100vh; flex-shrink: 0;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }

        /* CARROSSE ACTIONS */
        .story-container { width: 100vw; height: 100vh; background: #000; position: relative; }
        #carrosse-media { width: 100%; height: 100%; object-fit: cover; }
        .fab-container { position: absolute; bottom: 100px; width: 100%; display: flex; justify-content: space-between; padding: 0 30px; box-sizing: border-box; pointer-events: none; }
        .fab { width: 50px; height: 50px; background: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; box-shadow: 0 8px 20px rgba(0,0,0,0.6); pointer-events: auto; cursor: pointer; }
        .fab svg { width: 24px; height: 24px; fill: black; }
        .vote-badge { position: absolute; top: -25px; background: white; color: black; padding: 2px 8px; border-radius: 4px; font-weight: 900; font-size: 0.7rem; }

        /* PROFIL */
        .profile-card { background: rgba(255,255,255,0.05); padding: 30px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); width: 80%; max-width: 320px; text-align: center; backdrop-filter: blur(10px); }
        .profile-card input { width: 90%; padding: 14px; background: #111; border: 1px solid #333; color: white; margin: 20px 0; border-radius: 10px; text-align: center; }
        
        h1 { font-size: 1rem; letter-spacing: 8px; opacity: 0.2; text-transform: uppercase; }
    </style>
</head>
<body>

    <div id="gps-container">
        <div class="dot" id="dot-0"></div><div class="dot" id="dot-1"></div>
        <div class="dot active" id="dot-2"></div><div class="dot" id="dot-3"></div>
        <div class="dot" id="dot-4"></div>
    </div>

    <nav id="taskbar">
        <div class="nav-item" id="nav-0" onclick="goTo(0)"><svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/></svg></div>
        <div class="nav-item" id="nav-1" onclick="goTo(1)"><svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div>
        <div class="nav-item active" id="nav-2" onclick="goTo(2)"><svg viewBox="0 0 24 24"><path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/></svg></div>
        <div class="nav-item" id="nav-3" onclick="goTo(3)"><svg viewBox="0 0 24 24"><path d="M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 10.63 21 8.55 21 8V7c0-1.1-.9-2-2-2z"/></svg></div>
        <div class="nav-item" id="nav-4" onclick="goTo(4)"><svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg></div>
    </nav>

    <div id="main-viewport">
        <div class="page"><h1>Missions</h1></div>
        <div class="page">
            <div class="profile-card">
                <h2>PILOTE</h2>
                <input type="text" id="username-input" placeholder="TON NOM">
                <button style="width:100%; padding:14px; background:white; color:black; border:none; border-radius:10px; font-weight:900;" onclick="saveProfile()">ACTIVER</button>
            </div>
        </div>
        <div class="page">
            <div class="story-container">
                <img src="https://images.unsplash.com/photo-1614162692292-7ac56d7f7f1e?auto=format&fit=crop&w=800" id="carrosse-media">
                <div class="fab-container">
                    <div class="fab" onclick="handlePost()"><svg viewBox="0 0 24 24"><path d="M12 12m-3.2 0a3.2 3.2 0 1 0 6.4 0a3.2 3.2 0 1 0 -6.4 0M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9z"/></svg></div>
                    <div class="fab" onclick="castVote()">
                        <div id="vote-count" class="vote-badge">0</div>
                        <svg viewBox="0 0 24 24"><path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"/></svg>
                    </div>
                </div>
            </div>
            <input type="file" id="file-input" style="display:none">
        </div>
        <div class="page"><h1>Le Mur</h1></div>
        <div class="page"><h1>Chat</h1></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, updateDoc, increment, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBIsxyL2jrrhvUpypSZqt4eakbZb2XR7Jk",

  authDomain: "up-t-network.firebaseapp.com",

  projectId: "up-t-network",

  storageBucket: "up-t-network.firebasestorage.app",

  messagingSenderId: "1066469813456",

  appId: "1:1066469813456:web:4b660350832ea1d95702d5",

  measurementId: "G-7CSRYYCZWV"

        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const docRef = doc(db, "challenges", "week_01");

        let user = localStorage.getItem('up-t-user');

        onSnapshot(docRef, (snap) => {
            if (snap.exists()) {
                const d = snap.data();
                document.getElementById('vote-count').innerText = d.votes || 0;
                if(d.photoBase64) document.getElementById('carrosse-media').src = d.photoBase64;
            }
        });

        window.castVote = async function() {
            try { await updateDoc(docRef, { votes: increment(1) }); } catch(e) {}
        };

        window.handlePost = function() {
            if(!user) { alert("Identifie-toi !"); window.goTo(1); }
            else { document.getElementById('file-input').click(); }
        };

        window.saveProfile = function() {
            const name = document.getElementById('username-input').value;
            if(name.length > 2) {
                localStorage.setItem('up-t-user', name);
                user = name; window.goTo(2);
                setTimeout(() => { document.getElementById('file-input').click(); }, 600);
            }
        };

        document.getElementById('file-input').addEventListener('change', (e) => {
            const f = e.target.files[0];
            const r = new FileReader();
            r.onloadend = async () => { await updateDoc(docRef, { photoBase64: r.result, author: user }); };
            if(f) r.readAsDataURL(f);
        });

        // Navigation Engine
        let cur = 2; let sX = 0;
        window.goTo = function(idx) {
            cur = idx;
            document.getElementById('main-viewport').style.transform = `translateX(${-idx * 100}vw)`;
            document.querySelectorAll('.dot').forEach((d, i) => d.classList.toggle('active', i === idx));
            document.querySelectorAll('.nav-item').forEach((n, i) => n.classList.toggle('active', i === idx));
        };

        window.addEventListener('touchstart', e => { sX = e.touches[0].clientX; });
        window.addEventListener('touchend', e => {
            let dx = sX - e.changedTouches[0].clientX;
            if(dx > 50 && cur < 4) window.goTo(cur + 1);
            if(dx < -50 && cur > 0) window.goTo(cur - 1);
        });
    </script>
</body>
</html>
